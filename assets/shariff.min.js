/*! Shariff for bolt - v1.0.0 - 17.02.2015, https://gitlab.daniel-kulbe.de/root/bolt-shariff
 * @author: Daniel Kulbe <info@daniel-kulbe.de>, Licensed under the MIT
 * @based-on: shariff - v1.7.3 - 14.02.2015, https://github.com/heiseonline/shariff, Copyright (c) 2015 Ines Pauer, Philipp Busse, Sebastian Hilbig, Erich Kramer, Deniz Sesli, Licensed under the MIT <http://www.opensource.org/licenses/mit-license.php> license
 */
!function(t){function e(e,n){this.$element=t(e),this.options=n,this.$links=this.$element.find(".shariff-button"),!this.options.url.length&&this.setUrl(),this.replacePattern(),this.refresh(),this.initButtons(),this.debug(this)}function n(n){return this.each(function(){var r=t(this),o=r.data("shariff"),i=t.extend({},e.DEFAULTS,r.data(),"object"==typeof n&&n);o||r.data("shariff",o=new e(this,i))})}e.VERSION="1.0.0",e.DEFAULTS={debug:!1,url:null,referrer:null,backend:null,params:{}},e.prototype.debug=function(t){this.options.debug&&"undefined"!=typeof window.console&&window.console.debug(t)},e.prototype.getMeta=function(e){return t('meta[name="'+e+'"],[property="'+e+'"]').attr("content")},e.prototype.updateQuery=function(e,n){function r(t){return t===!0?"":"="+encodeURIComponent(t).replace(/'/g,"%27").replace(/"/g,"%22")}var o=window.document.createElement("a");if(o.href=n,!e)return(o.search="")&&o.href;if("string"==typeof e){var i={};t.each(e.replace(/^\?/,"").split("&"),function(){var t=this.split("=");i[t[0]]=t[1].length?decodeURIComponent(t[1].replace(/\+/g," ")):!0}),e=i}return t.each(e,function(t,e){var i=new RegExp("((?:"+t+")(=[a-zA-Z0-9%]+)?(&)?)","gi");i.test(n)?o.search=o.search.replace(i,function(){return e?t+r(e)+("string"==typeof arguments[3]?arguments[3]:""):""})||o.search+(indexOf("?")?"&":"?")+t+r(e):o.search+=(o.search.length?"&":"")+encodeURIComponent(t)+r(e)}),o.href},e.prototype.getShares=function(){return t.getJSON(this.options.backend+"?url="+encodeURIComponent(this.options.url))},e.prototype.updateCounts=function(e){var n=this;this.debug(e),t.each(e,function(e,r){var o=t(">[rel=popup]",n.$links.filter("."+e));o.length&&t(".share-count",o).text(r>=1e3?Math.round(r/1e3)+"k":r)&&o.trigger(t.Event("update.shariff.count"))})},e.prototype.setUrl=function(){var e=window.document.location.href,n=t("link[rel=canonical]").attr("href")||this.getMeta("og:url")||"";return n.length>0&&(n.indexOf("http")<0&&(n=window.document.location.protocol+"//"+window.document.location.host+n),e=n),this.debug("setUrl "+e),this.options.url=e},e.prototype.replacePattern=function(){var e=this.getMeta("og:site_name"),n=this.getMeta("og:title"),r={"{{URL}}":this.options.url,"{{NAME}}":e||window.document.location.hostname,"{{TITLE}}":n||t(n).text(),"{{SHARE}}":e&&n?e+" - "+n:t(n).text(),"{{TEXT}}":this.getMeta("og:description")||this.getMeta("description"),"{{IMAGE}}":this.getMeta("og:image")};for(var o in r){var i=r[o];for(var s in this.options.params){var a=this.options.params[s];for(var h in a){var p=a[h];this.options.params[s][h]="string"==typeof i&&p.length>=o.length?p.replace(o,i):i}}}return this.options.params},e.prototype.initButtons=function(){var e=this;this.$links.each(function(){var n=t("a",this)[0],r=t(this).attr("class").split(" ");t.each(r,function(){this in e.options.params&&(n.href=e.updateQuery(e.options.params[this],n.href)),e.options.referrer&&(n.href=e.updateQuery(e.options.referrer,n.href))}),n.attributes.rel&&"popup"===n.attributes.rel.value&&t(this).on("click.shariff.popuptrigger",n,t.proxy(e.popup,e,n))})},e.prototype.popup=function(e,n){n.preventDefault();{var r=t(e);window.open(r.attr("href"),r.attr("title"),"width=600,height=460")}this.refresh(n)},e.prototype.refresh=function(e){e&&this.debug(e),null!==this.options.backend&&this.getShares().then(t.proxy(this.updateCounts,this),t.proxy(this.debug,this))},t.fn.shariff=n,t.fn.shariff.Constructor=e,t(window).on("load",function(){t(".shariff").each(function(){var e=t(this);n.call(e,e.data())})})}(jQuery);